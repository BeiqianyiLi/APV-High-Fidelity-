<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apple Vision Pro | Co-Branding & Customization</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.4.0/model-viewer.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=JetBrains+Mono:wght@400;500&family=Pacifico&family=Impact&display=swap');
        
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #0f0f0f 100%);
            color: #f5f5f7;
            overflow-x: hidden;
        }
        
        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .glass-strong {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(30px) saturate(200%);
            -webkit-backdrop-filter: blur(30px) saturate(200%);
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        
        /* Left viewer area: no box, blends into background */
        .viewer-area {
            min-height: 500px;
            position: relative;
        }
        
        .viewer-area model-viewer {
            width: 100%;
            height: 100%;
            min-height: 500px;
            --poster-color: transparent;
            --progress-bar-color: rgba(255, 255, 255, 0.3);
        }
        
        .viewer-area model-viewer::part(default-progress-bar) {
            display: none;
        }
        
        /* Tab navigation */
        .tab-button {
            transition: all 0.3s ease;
            position: relative;
        }
        
        .tab-button.active {
            color: #fff;
        }
        
        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: #fff;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Brand cards: fixed size */
        .brand-card {
            width: 160px;
            min-width: 160px;
            height: 200px;
            flex-shrink: 0;
            scroll-snap-align: start;
            transition: all 0.3s ease;
        }
        
        .brand-card:hover {
            transform: scale(1.05) translateY(-4px);
        }
        
        .brand-card.selected {
            border: 2px solid rgba(255, 255, 255, 0.5);
        }
        
        .brand-card .logo-wrap {
            width: 100%;
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .brand-card .logo-wrap img {
            width: 25%;
            height: 25%;
            min-width: 32px;
            min-height: 32px;
            object-fit: contain;
        }
        
        .brand-scroll-container {
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        .brand-scroll-container::-webkit-scrollbar {
            display: none;
        }
        
        .rewards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
        }
        
        .reward-card {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            padding: 1.25rem;
            transition: all 0.3s ease;
        }
        
        .reward-card:hover {
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .reward-image-placeholder {
            width: 100%;
            aspect-ratio: 16/9;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 0.75rem;
            font-size: 1.5rem;
        }
        
        html {
            scroll-behavior: smooth;
        }
        
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
        }
        
        .price-bounce {
            animation: priceBounce 0.5s ease;
        }
        
        @keyframes priceBounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        /* Toast notification */
        .toast {
            position: fixed;
            top: 2rem;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            z-index: 1000;
            padding: 1rem 2rem;
            background: rgba(255, 255, 255, 0.95);
            color: #1a1a1a;
            border-radius: 12px;
            font-weight: 500;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            opacity: 0;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.4s ease;
        }
        
        .toast.visible {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        
        .toast.fade-out {
            opacity: 0;
            transform: translateX(-50%) translateY(-20px);
        }
        
        .btn-added {
            background: #22c55e !important;
            color: white !important;
        }
    </style>
</head>
<body>
    <!-- Toast (hidden by default) -->
    <div id="toast" class="toast" aria-live="polite">
        Apple Vision Pro added to your cart.
    </div>

    <!-- Hero Section -->
    <section id="hero" class="min-h-screen flex items-center justify-center relative overflow-hidden">
        <div class="container mx-auto px-6 text-center z-10">
            <h1 class="text-6xl md:text-8xl font-light mb-6 tracking-tight">
                <span class="bg-gradient-to-r from-white via-blue-100 to-purple-100 bg-clip-text text-transparent">
                    Customize Your Vision
                </span>
            </h1>
            <p class="text-2xl md:text-3xl font-light text-gray-400 mb-12 tracking-wide">
                Exclusive Collaboration with Apple Vision Pro
            </p>
            <button 
                onclick="scrollToMain()" 
                class="px-12 py-4 bg-white text-black rounded-full text-lg font-medium hover:bg-gray-100 transition-all duration-300"
            >
                Start Exploring
            </button>
        </div>
        <div class="absolute bottom-10 left-1/2 transform -translate-x-1/2 animate-bounce">
            <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
            </svg>
        </div>
    </section>

    <!-- Main Content -->
    <section id="main-content" class="min-h-screen py-20 px-6">
        <div class="container mx-auto max-w-7xl">
            <div class="flex justify-center mb-12 border-b border-white/10">
                <button id="tab-co-branded" onclick="switchTab('co-branded')" class="tab-button active px-8 py-4 text-lg font-medium text-gray-400 hover:text-white">
                    Co-Branded Editions
                </button>
                <button id="tab-personalize" onclick="switchTab('personalize')" class="tab-button px-8 py-4 text-lg font-medium text-gray-400 hover:text-white">
                    Personalize Your Own
                </button>
            </div>

            <!-- TAB 1: Co-Branded Editions -->
            <div id="content-co-branded" class="tab-content active">
                <div class="mb-10">
                    <h2 class="text-3xl font-light mb-6 text-center">Select Your Edition</h2>
                    <div class="brand-scroll-container flex gap-4 pb-2 justify-center flex-wrap md:flex-nowrap md:justify-start">
                        <div class="brand-card glass-strong rounded-2xl p-4 cursor-pointer flex flex-col items-center justify-between" onclick="selectCoBrand('rolex', this)">
                            <div class="logo-wrap flex-1">
                                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext x='50' y='55' font-size='50' text-anchor='middle' fill='%23d4af37'%3EâŒš%3C/text%3E%3C/svg%3E" alt="Rolex" />
                            </div>
                            <h3 class="text-sm font-medium text-center">Rolex</h3>
                        </div>
                        <div class="brand-card glass-strong rounded-2xl p-4 cursor-pointer flex flex-col items-center justify-between" onclick="selectCoBrand('porsche', this)">
                            <div class="logo-wrap flex-1">
                                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext x='50' y='55' font-size='50' text-anchor='middle' fill='%23c8102e'%3EðŸŽ%3C/text%3E%3C/svg%3E" alt="Porsche" />
                            </div>
                            <h3 class="text-sm font-medium text-center">Porsche</h3>
                        </div>
                        <div class="brand-card glass-strong rounded-2xl p-4 cursor-pointer flex flex-col items-center justify-between" onclick="selectCoBrand('louisvuitton', this)">
                            <div class="logo-wrap flex-1">
                                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext x='50' y='55' font-size='50' text-anchor='middle' fill='%23c9a961'%3EðŸ‘œ%3C/text%3E%3C/svg%3E" alt="Louis Vuitton" />
                            </div>
                            <h3 class="text-sm font-medium text-center">Louis Vuitton</h3>
                        </div>
                        <div class="brand-card glass-strong rounded-2xl p-4 cursor-pointer flex flex-col items-center justify-between" onclick="selectCoBrand('starbucks', this)">
                            <div class="logo-wrap flex-1">
                                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext x='50' y='55' font-size='50' text-anchor='middle' fill='%2300704a'%3Eâ˜•%3C/text%3E%3C/svg%3E" alt="Starbucks" />
                            </div>
                            <h3 class="text-sm font-medium text-center">Starbucks</h3>
                        </div>
                        <div class="brand-card glass-strong rounded-2xl p-4 cursor-pointer flex flex-col items-center justify-between" onclick="selectCoBrand('nike', this)">
                            <div class="logo-wrap flex-1">
                                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext x='50' y='55' font-size='50' text-anchor='middle' fill='%23fff'%3Eâœ“%3C/text%3E%3C/svg%3E" alt="Nike" />
                            </div>
                            <h3 class="text-sm font-medium text-center">Nike</h3>
                        </div>
                        <div class="brand-card glass-strong rounded-2xl p-4 cursor-pointer flex flex-col items-center justify-between" onclick="selectCoBrand('supreme', this)">
                            <div class="logo-wrap flex-1">
                                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext x='50' y='55' font-size='50' text-anchor='middle' fill='%23fff'%3Eâ¬›%3C/text%3E%3C/svg%3E" alt="Supreme" />
                            </div>
                            <h3 class="text-sm font-medium text-center">Supreme</h3>
                        </div>
                        <div class="brand-card glass-strong rounded-2xl p-4 cursor-pointer flex flex-col items-center justify-between" onclick="selectCoBrand('lego', this)">
                            <div class="logo-wrap flex-1">
                                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext x='50' y='55' font-size='50' text-anchor='middle' fill='%23ffd700'%3EðŸ§±%3C/text%3E%3C/svg%3E" alt="Lego" />
                            </div>
                            <h3 class="text-sm font-medium text-center">Lego</h3>
                        </div>
                        <div class="brand-card glass-strong rounded-2xl p-4 cursor-pointer flex flex-col items-center justify-between" onclick="selectCoBrand('nasa', this)">
                            <div class="logo-wrap flex-1">
                                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext x='50' y='55' font-size='50' text-anchor='middle' fill='%23003d82'%3EðŸš€%3C/text%3E%3C/svg%3E" alt="NASA" />
                            </div>
                            <h3 class="text-sm font-medium text-center">NASA</h3>
                        </div>
                        <div class="brand-card glass-strong rounded-2xl p-4 cursor-pointer flex flex-col items-center justify-between" onclick="selectCoBrand('balenciaga', this)">
                            <div class="logo-wrap flex-1">
                                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext x='50' y='55' font-size='50' text-anchor='middle' fill='%23fff'%3EðŸ‘”%3C/text%3E%3C/svg%3E" alt="Balenciaga" />
                            </div>
                            <h3 class="text-sm font-medium text-center">Balenciaga</h3>
                        </div>
                        <div class="brand-card glass-strong rounded-2xl p-4 cursor-pointer flex flex-col items-center justify-between" onclick="selectCoBrand('kaws', this)">
                            <div class="logo-wrap flex-1">
                                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext x='50' y='55' font-size='50' text-anchor='middle' fill='%23a855f7'%3EðŸŽ¨%3C/text%3E%3C/svg%3E" alt="KAWS" />
                            </div>
                            <h3 class="text-sm font-medium text-center">KAWS</h3>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-[55%_45%] gap-8">
                    <!-- Left: True 3D viewer (no box, blends in) -->
                    <div class="viewer-area flex items-center justify-center">
                        <model-viewer
                            id="model-viewer-co"
                            src="assets/apple-vision-pro/source/apple-vision-pro-Dexton/source/apple-vision-pro.glb"
                            alt="Apple Vision Pro Co-Branded"
                            camera-controls
                            disable-zoom
                            camera-orbit="0deg 75deg 2.5m"
                            min-camera-orbit="auto auto 1.5m"
                            max-camera-orbit="auto auto 4m"
                            style="width:100%;height:100%;min-height:500px;"
                        >
                            <div class="absolute inset-0 flex items-center justify-center bg-transparent" slot="poster">
                                <span class="text-8xl opacity-50">ðŸ¥½</span>
                            </div>
                        </model-viewer>
                    </div>

                    <!-- Right: Story & Rewards -->
                    <div class="space-y-6 flex flex-col">
                        <div class="glass rounded-2xl p-6">
                            <h3 class="text-xl font-medium mb-3" id="co-brand-title">Select an Edition</h3>
                            <div id="co-brand-story" class="text-gray-300 leading-relaxed text-sm">
                                <p>Choose a co-branded edition above to view its story and rewards.</p>
                            </div>
                        </div>
                        <div class="glass rounded-2xl p-6">
                            <h3 class="text-lg font-medium mb-3">Exclusive Rewards</h3>
                            <div id="co-brand-rewards" class="rewards-grid">
                                <div class="reward-card">
                                    <div class="reward-image-placeholder">ðŸ“¦</div>
                                    <p class="text-sm text-gray-300">Select an edition to view rewards</p>
                                </div>
                            </div>
                        </div>
                        <!-- Price & Add to Bag at bottom of right panel -->
                        <div class="glass-strong rounded-2xl p-6 mt-auto">
                            <div class="flex flex-col gap-4">
                                <div>
                                    <div class="text-sm text-gray-400 mb-1">Price</div>
                                    <div id="co-brand-price" class="text-3xl font-light">$3,499</div>
                                </div>
                                <button
                                    id="btn-add-co"
                                    type="button"
                                    onclick="addCoBrandToBag()"
                                    class="w-full px-8 py-4 bg-white text-black rounded-full text-lg font-medium hover:bg-gray-100 transition-all duration-300"
                                >
                                    Add to Bag
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB 2: Personalize Your Own -->
            <div id="content-personalize" class="tab-content">
                <div class="grid grid-cols-1 lg:grid-cols-[55%_45%] gap-8">
                    <!-- Left: True 3D viewer -->
                    <div class="viewer-area flex items-center justify-center">
                        <model-viewer
                            id="model-viewer-personalize"
                            src="assets/apple-vision-pro/source/apple-vision-pro-Dexton/source/apple-vision-pro.glb"
                            alt="Apple Vision Pro"
                            camera-controls
                            disable-zoom
                            camera-orbit="0deg 75deg 2.5m"
                            min-camera-orbit="auto auto 1.5m"
                            max-camera-orbit="auto auto 4m"
                            style="width:100%;height:100%;min-height:500px;"
                        >
                            <div class="absolute inset-0 flex items-center justify-center bg-transparent" slot="poster">
                                <span class="text-8xl opacity-50">ðŸ¥½</span>
                            </div>
                        </model-viewer>
                    </div>

                    <!-- Right: Customization + Price at bottom -->
                    <div class="space-y-6 flex flex-col">
                        <div class="glass rounded-2xl p-6">
                            <h3 class="text-xl font-medium mb-4">Material & Color</h3>
                            <div class="mb-4">
                                <label class="text-sm font-medium text-gray-300 mb-2 block">Material</label>
                                <select id="material-select" onchange="updateMaterial()" class="w-full px-4 py-3 bg-black/30 border border-white/10 rounded-xl text-white focus:outline-none focus:border-blue-500 text-sm">
                                    <option value="leather">Premium Leather</option>
                                    <option value="knit">Knit</option>
                                    <option value="silicone">Silicone</option>
                                </select>
                            </div>
                            <label class="text-sm font-medium text-gray-300 mb-2 block">Color</label>
                            <div id="color-options" class="grid grid-cols-4 gap-3"></div>
                        </div>

                        <div class="glass rounded-2xl p-6">
                            <h3 class="text-xl font-medium mb-4">Advanced Engraving</h3>
                            <div class="mb-4">
                                <label class="text-sm font-medium text-gray-300 mb-2 block">Custom Text</label>
                                <input type="text" id="engraving-text" placeholder="Max 30 characters" maxlength="30" class="w-full px-4 py-3 bg-black/30 border border-white/10 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:border-blue-500 text-sm" oninput="updateEngravingPreview()" />
                            </div>
                            <div class="mb-4">
                                <label class="text-sm font-medium text-gray-300 mb-2 block">Font</label>
                                <select id="engraving-font" onchange="updateEngravingPreview()" class="w-full px-4 py-3 bg-black/30 border border-white/10 rounded-xl text-white focus:outline-none focus:border-blue-500 text-sm">
                                    <option value="Arial">Arial</option>
                                    <option value="Times New Roman">Times New Roman</option>
                                    <option value="Impact">Impact</option>
                                    <option value="Pacifico">Pacifico</option>
                                    <option value="Courier New">Courier New</option>
                                    <option value="Verdana">Verdana</option>
                                    <option value="Georgia">Georgia</option>
                                    <option value="Comic Sans MS">Comic Sans MS</option>
                                </select>
                            </div>
                            <div class="mb-4">
                                <label class="text-sm font-medium text-gray-300 mb-2 block">Font Size: <span id="font-size-value">24</span>px</label>
                                <input type="range" id="engraving-size" min="12" max="48" value="24" step="1" oninput="updateFontSizeDisplay(); updateEngravingPreview();" class="w-full" />
                            </div>
                            <div class="mb-4">
                                <label class="text-sm font-medium text-gray-300 mb-2 block">Text Color</label>
                                <div class="flex items-center gap-4">
                                    <input type="color" id="engraving-color" value="#ffffff" onchange="updateEngravingPreview()" class="w-12 h-12 rounded-lg cursor-pointer border-2 border-white/20" />
                                    <span id="color-hex" class="text-gray-400 text-xs">#ffffff</span>
                                </div>
                            </div>
                            <div>
                                <label class="text-sm font-medium text-gray-300 mb-2 block">Text Position</label>
                                <select id="engraving-position" onchange="updateEngravingPreview()" class="w-full px-4 py-3 bg-black/30 border border-white/10 rounded-xl text-white focus:outline-none focus:border-blue-500 text-sm">
                                    <option value="top">Top Frame</option>
                                    <option value="bottom">Bottom Lens</option>
                                    <option value="side">Side Band</option>
                                </select>
                            </div>
                        </div>

                        <!-- Price & Add to Bag at bottom of right panel -->
                        <div class="glass-strong rounded-2xl p-6 mt-auto">
                            <div class="flex flex-col gap-4">
                                <div>
                                    <div class="text-sm text-gray-400 mb-1">Starting from</div>
                                    <div id="price-display" class="text-3xl font-light">$3,499</div>
                                </div>
                                <button
                                    id="btn-add-personalize"
                                    type="button"
                                    onclick="addPersonalizeToBag()"
                                    class="w-full px-8 py-4 bg-white text-black rounded-full text-lg font-medium hover:bg-gray-100 transition-all duration-300"
                                >
                                    Add to Bag
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer class="py-12 px-6 border-t border-white/5">
        <div class="container mx-auto max-w-4xl">
            <p class="text-xs text-gray-500 text-center leading-relaxed">
                Disclaimer: This project is a conceptual prototype created solely for the CraterHacks 404 Hackathon. Not affiliated with Apple Inc. or any mentioned brands.
            </p>
        </div>
    </footer>

    <script>
        let currentTab = 'co-branded';
        let selectedCoBrand = null;
        let selectedMaterial = 'leather';
        let selectedColor = null;
        let engravingConfig = { text: '', font: 'Arial', size: 24, color: '#ffffff', position: 'top' };
        let basePrice = 3499;
        let currentPrice = basePrice;

        const coBrandData = {
            rolex: { name: 'Rolex Edition', title: 'Rolex Edition Vision Pro', story: 'Merging timeless Swiss craftsmanship with spatial computing.', rewards: [{ icon: 'ðŸ”ï¸', text: 'Rolex Virtual Environment' }, { icon: 'ðŸ’¼', text: 'Luxury travel case' }, { icon: 'ðŸ“œ', text: 'Certificate of authenticity' }], price: 5999 },
            porsche: { name: 'Porsche Edition', title: 'Porsche Edition Vision Pro', story: 'Where performance meets precision.', rewards: [{ icon: 'ðŸ­', text: 'Porsche Design Studio VR' }, { icon: 'ðŸ', text: 'Racing experience in VR' }, { icon: 'ðŸ“¦', text: 'Premium carrying case' }], price: 5499 },
            louisvuitton: { name: 'Louis Vuitton Edition', title: 'Louis Vuitton Edition Vision Pro', story: 'Haute couture meets high technology.', rewards: [{ icon: 'ðŸª', text: 'LV Virtual Boutique' }, { icon: 'ðŸŽ', text: 'Monogrammed case' }, { icon: 'ðŸ“‹', text: 'Certificate of authenticity' }], price: 6499 },
            starbucks: { name: 'Starbucks Edition', title: 'Starbucks Edition Vision Pro', story: 'Coffee culture in spatial computing.', rewards: [{ icon: 'ðŸ›ï¸', text: 'Reserve Roastery VR' }, { icon: 'â˜•', text: '6-month Reserve subscription' }, { icon: 'ðŸŽ', text: 'Branded accessories' }], price: 3999 },
            nike: { name: 'Nike Edition', title: 'Nike Edition Vision Pro', story: 'Just Do It in spatial computing.', rewards: [{ icon: 'ðŸƒ', text: 'Nike Training Club VR' }, { icon: 'ðŸ‘Ÿ', text: 'Nike spatial interfaces' }, { icon: 'ðŸ“¦', text: 'Nike premium case' }], price: 4299 },
            supreme: { name: 'Supreme Edition', title: 'Supreme Edition Vision Pro', story: 'Street culture meets spatial computing.', rewards: [{ icon: 'ðŸŽ¨', text: 'Supreme virtual environments' }, { icon: 'ðŸ“¦', text: 'Limited edition case' }, { icon: 'ðŸŽ«', text: 'Early access to drops' }], price: 4799 },
            lego: { name: 'Lego Edition', title: 'Lego Edition Vision Pro', story: 'Build your world in spatial computing.', rewards: [{ icon: 'ðŸ§±', text: 'Lego Builder Studio' }, { icon: 'ðŸŽ®', text: 'Lego building experiences' }, { icon: 'ðŸ“¦', text: 'Lego carrying case' }], price: 3799 },
            nasa: { name: 'NASA Edition', title: 'NASA Edition Vision Pro', story: 'Explore the cosmos in spatial computing.', rewards: [{ icon: 'ðŸŒŒ', text: 'ISS virtual tours' }, { icon: 'ðŸª', text: 'Planetary exploration' }, { icon: 'ðŸ“¦', text: 'NASA premium case' }], price: 5199 },
            balenciaga: { name: 'Balenciaga Edition', title: 'Balenciaga Edition Vision Pro', story: 'High fashion meets high tech.', rewards: [{ icon: 'ðŸ‘—', text: 'Virtual Fashion Show' }, { icon: 'ðŸ›ï¸', text: 'Digital fashion collection' }, { icon: 'ðŸ“¦', text: 'Luxury carrying case' }], price: 6999 },
            kaws: { name: 'KAWS Edition', title: 'KAWS Edition Vision Pro', story: 'Contemporary art in spatial computing.', rewards: [{ icon: 'ðŸ–¼ï¸', text: 'KAWS Virtual Gallery' }, { icon: 'ðŸŽ¨', text: 'Exclusive digital artworks' }, { icon: 'ðŸ“¦', text: 'KAWS premium case' }], price: 5799 }
        };

        const materialColors = {
            leather: [{ name: 'Midnight', value: '#111827' }, { name: 'Saddle Brown', value: '#78350f' }, { name: 'Crimson', value: '#7f1d1d' }, { name: 'Black', value: '#000000' }],
            knit: [{ name: 'Navy', value: '#1e3a8a' }, { name: 'Gray', value: '#4b5563' }, { name: 'Beige', value: '#fef3c7' }, { name: 'Charcoal', value: '#374151' }],
            silicone: [{ name: 'Black', value: '#000000' }, { name: 'White', value: '#ffffff' }, { name: 'Blue', value: '#2563eb' }, { name: 'Red', value: '#dc2626' }]
        };

        function switchTab(tabName) {
            currentTab = tabName;
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.getElementById('tab-' + tabName).classList.add('active');
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById('content-' + tabName).classList.add('active');
        }

        function selectCoBrand(brand, cardEl) {
            selectedCoBrand = brand;
            const data = coBrandData[brand];
            if (!data) return;
            document.getElementById('co-brand-title').textContent = data.title;
            document.getElementById('co-brand-story').innerHTML = '<p class="text-sm">' + data.story + '</p>';
            document.getElementById('co-brand-rewards').innerHTML = data.rewards.map(r =>
                '<div class="reward-card"><div class="reward-image-placeholder">' + r.icon + '</div><p class="text-sm text-gray-300">' + r.text + '</p></div>'
            ).join('');
            currentPrice = data.price;
            document.getElementById('co-brand-price').textContent = '$' + data.price.toLocaleString();
            document.querySelectorAll('.brand-card').forEach(c => c.classList.remove('selected'));
            if (cardEl) cardEl.classList.add('selected');
        }

        function showToast() {
            const toast = document.getElementById('toast');
            toast.classList.remove('fade-out');
            toast.classList.add('visible');
            setTimeout(() => {
                toast.classList.remove('visible');
                toast.classList.add('fade-out');
            }, 3000);
        }

        function setButtonAdded(buttonId) {
            const btn = document.getElementById(buttonId);
            if (!btn) return;
            const origText = btn.textContent;
            btn.textContent = 'Added to Bag âœ“';
            btn.classList.add('btn-added');
            setTimeout(() => {
                btn.textContent = origText;
                btn.classList.remove('btn-added');
            }, 3000);
        }

        function addCoBrandToBag() {
            if (!selectedCoBrand) {
                alert('Please select an edition first.');
                return;
            }
            setButtonAdded('btn-add-co');
            showToast();
        }

        function addPersonalizeToBag() {
            setButtonAdded('btn-add-personalize');
            showToast();
        }

        function updateMaterial() {
            selectedMaterial = document.getElementById('material-select').value;
            populateColorOptions();
            applyHeadbandColor();
        }

        function populateColorOptions() {
            const colors = materialColors[selectedMaterial] || [];
            const container = document.getElementById('color-options');
            container.innerHTML = colors.map(c =>
                '<button type="button" onclick="selectColor(\'' + c.value + '\')" class="aspect-square rounded-lg border-2 border-transparent hover:border-white/50 transition-all" style="background-color:' + c.value + '" data-color="' + c.value + '" title="' + c.name + '"></button>'
            ).join('');
        }

        function selectColor(colorValue) {
            selectedColor = colorValue;
            document.querySelectorAll('#color-options button').forEach(btn => {
                btn.classList.toggle('border-white', btn.dataset.color === colorValue);
            });
            applyHeadbandColor();
            updatePrice();
        }

        function hexToLinearRgb(hex) {
            const r = parseInt(hex.slice(1, 3), 16) / 255;
            const g = parseInt(hex.slice(3, 5), 16) / 255;
            const b = parseInt(hex.slice(5, 7), 16) / 255;
            const toLinear = c => c <= 0.04045 ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4);
            return [toLinear(r), toLinear(g), toLinear(b), 1];
        }

        function applyHeadbandColor() {
            const viewer = document.getElementById('model-viewer-personalize');
            if (!viewer || !selectedColor) return;
            function tryApply() {
                try {
                    const model = viewer.model;
                    if (!model || !model.materials) return;
                    const materials = model.materials;
                    const colorFactor = hexToLinearRgb(selectedColor);
                    var applied = false;
                    for (let i = 0; i < materials.length; i++) {
                        const mat = materials[i];
                        var name = (mat.name || '').toLowerCase();
                        if (name.indexOf('band') !== -1 || name.indexOf('strap') !== -1 || name.indexOf('headband') !== -1) {
                            if (mat.pbrMetallicRoughness) {
                                mat.pbrMetallicRoughness.setBaseColorFactor(colorFactor);
                                applied = true;
                            }
                        }
                    }
                    if (!applied && materials.length > 0 && materials[0].pbrMetallicRoughness) {
                        materials[0].pbrMetallicRoughness.setBaseColorFactor(colorFactor);
                    }
                } catch (e) {
                    console.warn('Model-viewer material update:', e);
                }
            }
            if (viewer.loaded) {
                tryApply();
            } else {
                viewer.addEventListener('load', tryApply);
            }
        }

        function updateEngravingPreview() {
            const text = document.getElementById('engraving-text').value;
            const font = document.getElementById('engraving-font').value;
            const size = parseInt(document.getElementById('engraving-size').value, 10);
            const color = document.getElementById('engraving-color').value;
            const position = document.getElementById('engraving-position').value;
            engravingConfig = { text, font, size, color, position };
            document.getElementById('color-hex').textContent = color.toUpperCase();
        }

        function updateFontSizeDisplay() {
            document.getElementById('font-size-value').textContent = document.getElementById('engraving-size').value;
        }

        function updatePrice() {
            let newPrice = basePrice;
            const premiums = { leather: 200, knit: 150, silicone: 100 };
            if (selectedMaterial && premiums[selectedMaterial]) newPrice += premiums[selectedMaterial];
            if (newPrice !== currentPrice) {
                currentPrice = newPrice;
                const el = document.getElementById('price-display');
                el.classList.add('price-bounce');
                el.textContent = '$' + newPrice.toLocaleString();
                setTimeout(() => el.classList.remove('price-bounce'), 500);
            }
        }

        function scrollToMain() {
            document.getElementById('main-content').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        document.addEventListener('DOMContentLoaded', () => {
            populateColorOptions();
            document.getElementById('engraving-color').addEventListener('input', function() {
                document.getElementById('color-hex').textContent = this.value.toUpperCase();
            });
            const viewer = document.getElementById('model-viewer-personalize');
            if (viewer) {
                viewer.addEventListener('load', () => applyHeadbandColor());
            }
        });
    </script>
</body>
</html>